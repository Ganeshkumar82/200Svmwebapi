const db = require('./db');
const helper = require('../helper');
const mailer = require('../mailer');
const config = require('../config');
const fs = require('fs');


//###################################################################################################################################################################################################################################################################################
//###################################################################################################################################################################################################################################################################################
//###################################################################################################################################################################################################################################################################################
//THIS FUNCTION IS USED TO FETCH THE SERVER STATUS OF THE SERVICES
//INPUT DATA
//{
//  "sname" : "Your setting values to which you want to check the server status",
//}
//###################################################################################################################################################################################################################################################################################
//###################################################################################################################################################################################################################################################################################
//###################################################################################################################################################################################################################################################################################

async function GetServerStatus(server){
    if(server.hasOwnProperty('sname') ==  false){
        return helper.getErrorResponse("SERVER_SETTING_NAME_MISSING","PLEASE PROVIDE THE SETTING VALUE ","");
    }
    const userinput =  server.sname;
    const sname = testInput(userinput);

    const [result] = await db.spcall('CALL getserversettings(?, @svalue); select @svalue',[sname]);
    const objectvalue = result[1][0];
    const svalue = objectvalue["@result"];
    console.log("SERVER SETTING VALUE -> "+ svalue);
    return svalue;
}

function testInput(data) {
    data = data.trim();
    data = data.replace(/\\/g, ''); 
    data = data.replace(/</g, '&lt;').replace(/>/g, '&gt;'); 
    return data;
  }

module.exports = {
   GetServerStatus,

};